tinymce.PluginManager.add("filemanager", function (_) { tinymce.activeEditor.settings.file_browser_callback = filemanager; function filemanager_onMessage(e) { if (_.settings.external_filemanager_path.toLowerCase().indexOf(e.origin.toLowerCase()) === 0) { if (e.data.sender === "responsivefilemanager") { tinymce.activeEditor.windowManager.getParams().setUrl(e.data.url); tinymce.activeEditor.windowManager.close(); if (window.removeEventListener) { window.removeEventListener("message", filemanager_onMessage, false) } else { window.detachEvent("onmessage", filemanager_onMessage) } } } } function filemanager(a, e, n, t) { var i = window.innerWidth - 30; var s = window.innerHeight - 60; if (i > 1800) i = 1800; if (s > 1200) s = 1200; if (i > 600) { var r = (i - 20) % 138; i = i - r + 10 } urltype = 2; if (n == "image") { urltype = 1 } if (n == "media") { urltype = 3 } var g = "RESPONSIVE FileManager"; if (typeof _.settings.filemanager_title !== "undefined" && _.settings.filemanager_title) { g = _.settings.filemanager_title } var f = "key"; if (typeof _.settings.filemanager_access_key !== "undefined" && _.settings.filemanager_access_key) { f = _.settings.filemanager_access_key } var l = ""; if (typeof _.settings.filemanager_sort_by !== "undefined" && _.settings.filemanager_sort_by) { l = "&sort_by=" + _.settings.filemanager_sort_by } var o = "false"; if (typeof _.settings.filemanager_descending !== "undefined" && _.settings.filemanager_descending) { o = _.settings.filemanager_descending } var d = ""; if (typeof _.settings.filemanager_subfolder !== "undefined" && _.settings.filemanager_subfolder) { d = "&fldr=" + _.settings.filemanager_subfolder } var m = ""; if (document.getElementById("TinyMCE_RootFolder")) { m = "&rootFolder=" + document.getElementById("TinyMCE_RootFolder").value } var c = ""; if (typeof _.settings.filemanager_crossdomain !== "undefined" && _.settings.filemanager_crossdomain) { c = "&crossdomain=1"; if (window.addEventListener) { window.addEventListener("message", filemanager_onMessage, false) } else { window.attachEvent("onmessage", filemanager_onMessage) } } tinymce.activeEditor.windowManager.open({ title: g, file: _.settings.external_filemanager_path + "dialog.php?type=" + urltype + "&descending=" + o + l + m + d + c + "&lang=" + _.settings.language + "&akey=" + f, width: i, height: s, resizable: true, maximizable: true, inline: 1 }, { setUrl: function (e) { var n = t.document.getElementById(a); n.value = _.convertURL(e); if ("createEvent" in document) { var i = document.createEvent("HTMLEvents"); i.initEvent("change", false, true); n.dispatchEvent(i) } else { n.fireEvent("onchange") } } }) } return false });